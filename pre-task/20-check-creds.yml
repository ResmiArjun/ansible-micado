---
- name: (Ansible) Checking the existence of cloud credentials file
  stat: path={{ cloud_cred_path }}
  delegate_to: localhost
  register: cloud_cred_file
  changed_when: False
  tags:
  - start
  - update-auth

- name: (Ansible) Checking the existence of gce credentials file
  stat: path={{ gce_cred_path }}
  delegate_to: localhost
  register: gce_cred_file
  changed_when: False
  tags:
  - start
  - update-auth

- name: (Ansible) Checking the existence of OCI private key file
  stat: path={{ oci_key_path }}
  delegate_to: localhost
  register: oci_key_file
  changed_when: False
  tags:
  - start
  - update-auth

- name: (Ansible) Credential check for cloud orchestrators
  fail:
    msg: Occopus/Terraform is enabled but matching credential not file found...
  when: >
    (enable_occopus and not cloud_cred_file.stat.exists) or
    (enable_terraform and not cloud_cred_file.stat.exists and not gce_cred_file.stat.exists)
  tags:
  - start

- name: (Ansible) Check for cloud orchestrators
  pause:
    prompt: >
      You are deploying MiCADO without a cloud orchestrator...
      Press 'Ctrl-C' to abort...
    seconds: 10
  when: not enable_occopus and not enable_terraform
  tags:
  - start

- name: (Ansible) Checking the existence of security settings file
  stat: path={{ micado_cred_path }}
  delegate_to: localhost
  register: security_cred_file
  tags:
  - start
